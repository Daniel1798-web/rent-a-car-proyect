generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  customer
  employee
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

model User {
  id           String        @id @default(uuid())
  email        String        @unique
  name         String
  password     String
  role         Role          @default(customer)
  discounts    Discount[]
  reservations Reservation[]
  createdAt    DateTime      @default(now())
}

model Branch {
  id           String        @id @default(uuid())
  name         String
  address      String
  inventory    Inventory[]
  reservations Reservation[]
}

model CarModel {
  id           String        @id @default(uuid())
  make         String
  model        String
  seats        Int
  dailyRate    Float
  inventory    Inventory[]
  reservations Reservation[]

  @@unique([make, model], name: "make_model")
}

model Inventory {
  id         String   @id @default(uuid())
  branch     Branch   @relation(fields: [branchId], references: [id])
  branchId   String
  carModel   CarModel @relation(fields: [carModelId], references: [id])
  carModelId String
  quantity   Int      @default(0)

  @@unique([branchId, carModelId])
}

model Discount {
  id          String        @id @default(uuid())
  code        String?
  percentage  Int
  validFrom   DateTime
  validTo     DateTime
  active      Boolean       @default(true)
  user        User?         @relation(fields: [userId], references: [id])
  userId      String?
  Reservation Reservation[]
}

model Reservation {
  id         String            @id @default(uuid())
  user       User              @relation(fields: [userId], references: [id])
  userId     String
  carModel   CarModel          @relation(fields: [carModelId], references: [id])
  carModelId String
  branch     Branch            @relation(fields: [branchId], references: [id])
  branchId   String
  startDate  DateTime
  endDate    DateTime
  totalPrice Float
  discount   Discount?         @relation(fields: [discountId], references: [id])
  discountId String?
  status     ReservationStatus @default(CONFIRMED)
  createdAt  DateTime          @default(now())
}
